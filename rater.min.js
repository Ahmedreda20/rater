!function(t,e){function s(e,s){this.element=e,this.settings=t.extend({},t.fn.rate.settings,s),this.set_faces={},this.build()}t.fn.textWidth=function(){var e=t("<span>"+t(this).html()+"</span>");e.css("font-size",t(this).css("font-size")).hide(),e.prependTo("body");var s=e.width();return e.remove(),s},t.fn.textHeight=function(){var e=t("<span>"+t(this).html()+"</span>");e.css("font-size",t(this).css("font-size")).hide(),e.prependTo("body");var s=e.height();return e.remove(),s},t.fn.rate=function(e){if(void 0===e||"object"==typeof e)return this.each(function(){t.data(this,"rate")||t.data(this,"rate",new s(this,e))});if("string"==typeof e){var i,a=arguments;return this.each(function(){var n=t.data(this,"rate");n instanceof s&&"function"==typeof n[e]&&(i=n[e].apply(n,Array.prototype.slice.call(a,1))),"destroy"===e&&(t(n.element).off(),t.data(this,"rate",null))}),void 0!==i?i:this}},s.prototype.build=function(){this.layers={},this.value=0,this.raise_select_layer=!1,this.settings.initial_value&&(this.value=this.settings.initial_value),t(this.element).attr("data-rate-value")&&(this.value=t(this.element).attr("data-rate-value"));var e=this.value/this.settings.max_value,s=this.addLayer("base-layer",1,this.settings.symbols[this.settings.selected_symbol_type].base,!0),i=this.addLayer("select-layer",e,this.settings.symbols[this.settings.selected_symbol_type].selected,!0),a=this.addLayer("hover-layer",0,this.settings.symbols[this.settings.selected_symbol_type].hover,!1);this.layers.base_layer=s,this.layers.select_layer=i,this.layers.hover_layer=a,t(this.element).on("mousemove",t.proxy(this.hover,this)),t(this.element).on("click",t.proxy(this.select,this)),t(this.element).on("mouseleave",t.proxy(this.mouseout,this)),this.value=this.toValue(e*t(s).textWidth())},s.prototype.addLayer=function(e,s,i,a){for(var n="<div>",h=0;h<this.settings.max_value;h++)n+="<span>"+i+"</span>";n+="</div>";var l=t(n).addClass("rate-"+e).appendTo(this.element);return t(l).css({width:s*t(l).textWidth()+"px",overflow:"hidden",position:"absolute",top:0,display:a?"block":"none"}),t(this.element).css({height:t(l).height(),position:"relative",cursor:this.settings.cursor}),l},s.prototype.updateServer=function(){void 0!=this.settings.url&&t.ajax({url:this.settings.url,type:this.settings.ajax_method,data:t.extend({},{value:this.getValue()},this.settings.additional_data),success:t.proxy(function(e){t(this.element).trigger("updateSuccess",[e])},this),error:t.proxy(function(e,s,i){t(this.element).trigger("updateError",[e,s,i])},this)})},s.prototype.getValue=function(){return this.value},s.prototype.hover=function(e){var s=e.pageX-t(this.element).offset().left,i=this.toValue(s);if(i!=this.value&&(this.raise_select_layer=!1),!this.raise_select_layer&&!this.settings.readonly){var a=this.toWidth(i);this.layers.select_layer.css({display:"none"}),this.layers.hover_layer.css({width:a,display:"block"})}},s.prototype.select=function(e){if(!this.settings.readonly){var s=(this.getValue(),e.pageX-t(this.element).offset().left),i=this.toWidth(this.toValue(s));this.setValue(this.toValue(i)),this.raise_select_layer=!0}},s.prototype.mouseout=function(){this.layers.hover_layer.css({display:"none"}),this.layers.select_layer.css({display:"block"})},s.prototype.toWidth=function(t){return t/this.settings.max_value*this.layers.base_layer.textWidth()},s.prototype.toValue=function(t){var e=t/this.layers.base_layer.textWidth()*this.settings.max_value;return Math.abs(e-Math.floor(e)<5e-5)&&(e=Math.floor(e)),e=Math.ceil(e/this.settings.step_size)*this.settings.step_size,e=e>this.settings.max_value?this.settings.max_value:e},s.prototype.getElement=function(e,s){return t(this.element).find(".rate-"+e+" span").eq(s-1)},s.prototype.getLayers=function(){return this.layers},s.prototype.setFace=function(t,e){this.set_faces[t]=e},s.prototype.setAdditionalData=function(t){this.settings.additional_data=t},s.prototype.getAdditionalData=function(){return this.settings.additional_data},s.prototype.removeFace=function(t){delete this.set_faces[t]},s.prototype.setValue=function(e){if(!this.settings.readonly){0>e?e=0:e>this.settings.max_value&&(e=this.settings.max_value);var s=this.getValue();this.value=e;t(this.element).trigger("change",{from:s,to:this.value});t(this.element).find(".rate-face").remove(),t(this.element).find("span").css({visibility:"visible"});var i=Math.ceil(this.value);if(this.set_faces.hasOwnProperty(i)){var a="<div>"+this.set_faces[i]+"</div>",n=this.getElement("base-layer",i),h=this.getElement("select-layer",i),l=this.getElement("hover-layer",i),r=n.textWidth()*(i-1)+(n.textWidth()-t(a).textWidth())/2;t(a).appendTo(this.element).css({display:"inline-block",position:"absolute",left:r}).addClass("rate-face"),n.css({visibility:"hidden"}),h.css({visibility:"hidden"}),l.css({visibility:"hidden"})}var o=this.toWidth(this.value);this.layers.select_layer.css({display:"block",width:o,height:this.layers.base_layer.css("height")}),this.layers.hover_layer.css({display:"none",height:this.layers.base_layer.css("height")}),t(this.element).attr("data-rate-value",this.value),this.settings.change_once&&(this.settings.readonly=!0),this.updateServer()}},s.prototype.increment=function(){this.setValue(this.getValue()+this.settings.step_size)},s.prototype.decrement=function(){this.setValue(this.getValue()-this.settings.step_size)},t.fn.rate.settings={max_value:10,step_size:.5,initial_value:0,symbols:{utf8_star:{base:"☆",hover:"★",selected:"★"},utf8_hexagon:{base:"⬡",hover:"⬢",selected:"⬢"},utf8_emoticons:["☺","ὠ3","ὠ6"]},selected_symbol_type:"utf8_star",cursor:"default",readonly:!1,change_once:!1,ajax_method:"POST",additional_data:{}}}(jQuery,window);